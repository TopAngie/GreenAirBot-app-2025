FROM ollama/ollama
USER root
RUN apt-get update && apt-get install -y curl
# Reset ENTRYPOINT so CMD is interpreted by /bin/sh directly
ENTRYPOINT []

# Start the server, preload model, then keep server running
CMD /bin/sh -c "\
  ollama serve & \
  until curl -s http://localhost:11434/v1/models > /dev/null; do echo 'Waiting for Ollama...'; sleep 1; done && \
  ollama pull mistral && \
  wait"